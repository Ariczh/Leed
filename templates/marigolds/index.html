{include="header"}

<!--
 @nom: index
 @auteur: Idleman (idleman@idleman.fr)
 @description: Page d'accueil et de lecture des flux
-->


{if="($configurationManager->get('articleDisplayAnonymous')=='1') || ($myUser!=false)"}

		

		<div id="main" class="wrapper clearfix index">
			<!--      -->
			<!-- MENU -->
			<!--      -->

			
			<div id="menuBar">
				{function="Plugin::callHook("menu_pre_folder_menu", array(&$myUser))"}
			<aside>
				<!-- TITRE MENU + OPTION TOUT MARQUER COMME LU -->
				<h3 class="left">{function="I18n::t('FEED')"}</h3> <button style="margin: 20px 10px;" onclick="if(confirm('{function="I18n::t('CONFIRM_MARK_ALL_AS_READ')"}'))window.location='action.php?action=readAll'">{function="I18n::t('MARK_ALL_AS_READ')"}</button>
				{function="Plugin::callHook("menu_post_header_options", array(&$myUser))"}
				<ul class="clear">
					
						
					
						<!--Pour chaques dossier-->
						{loop="folders"}
							{$feeds=""}
							<!--on récupere tous les flux lié au dossier-->
						  	{if="isset($allFeedsPerFolder[$value->getId()])"}
						  		{$feeds=$allFeedsPerFolder[$value->getId()]}
						  	{/if}
						  	{if="isset($allEvents[$value->getId()])"}
						  		{$unreadEventsForFolder=$allEvents[$value->getId()]}
						  	{/if}
				
					<!-- DOSSIER -->
					<li>

						<h1 class="folder">
							{function="Plugin::callHook("menu_pre_folder_link", array(&$value))"}
							<a  title="{function="I18n::t('READ_FOLDER_ITEMS')"}" href="index.php?action=selectedFolder&amp;folder={$value->getId()}">{$value->getName()}</a> <a class="readFolder" title="{function="I18n::t('FOLD_UNFOLD_FOLDER')"}" onclick="toggleFolder(this,{$value->getId()});" >{if="!$value->getIsopen()"}{function="I18n::t('UNFOLD')"}{else}{function="I18n::t('FOLD')"}{/if}</a> {if="$unreadEventsForFolder!=0"}<a class="unreadForFolder"  title="{function="I18n::t('MARK_AS_READ_FOLDER_ITEMS',array($unreadEventsForFolder))"}" onclick="if(confirm('{function="I18n::t('CONFIRM_MARK_AS_READ_FOLDER_ITEMS')"}'))window.location='action.php?action=readFolder&amp;folder={$value->getId()}';">{$unreadEventsForFolder} {function="I18n::t('UNREAD')"}</a>{/if}
							{function="Plugin::callHook("menu_post_folder_link", array(&$value))"}
						</h1>
						<!-- FLUX DU DOSSIER -->
						<ul {if="!$value->getIsopen()"}style="display:none;"{/if}>
							 
								{if="count($feeds)!=0"}
									{loop="feeds"}
										<li> 
											{function="Plugin::callHook("menu_pre_feed_link", array(&$value))"}											 <a href="index.php?action=selectedFeed&amp;feed={$value2['id']}" title="{$value2['url']}">{function="Functions::truncate($value2['name'],37)"} </a>
											{if="isset($unread[$value2['id']])"}  
											<button class="right" style="margin:5px 0 0 10px;" onclick="if(confirm('{function="I18n::t('CONFIRM_MARK_FEED_AS_READ')"}'))window.location='action.php?action=readAll&amp;feed={$value2['id']}';">
												<span alt="{function="I18n::t('MARK_AS_READ')"}" title="{function="I18n::t('MARK_AS_READ')"}">{$unread[$value2['id']]}</span>
											</button>
											{/if}
											{function="Plugin::callHook("menu_post_feed_link", array(&$value))"}
										</li>
									{/loop}
								{/if}
						</ul>
						<!-- FIN FLUX DU DOSSIER -->
					</li>
					<!-- FIN DOSSIER -->
					{$unreadEventsForFolder=0}
					{/loop}

					
					
				</ul>
			</aside>

			{function="Plugin::callHook("menu_post_folder_menu", array(&$myUser))"}
			</div>
			<!--          -->
			<!-- ARTICLES -->
			<!--          -->

			<article>
				<!-- ENTETE ARTICLE -->
				<header class="articleHead">
			
				{if="$action=='selectedFeed'"}
				<!-- AFFICHAGE DES EVENEMENTS D'UN FLUX EN PARTICULIER -->
				
						
					<h1 class="articleSection"><a target="_blank" href="{$currentFeed->getWebSite()}">{$currentFeed->getName()}</a></h1>
					<div class="clear"></div>
						{$currentFeed->getDescription()}  
							{function="I18n::t('SEE_THE')"} 
					<a href="index.php?action=selectedFeed&amp;feed={$_['feed']}&amp;page={$page}&amp;order=unread">{function="ucfirst(I18n::t('UNREAD'))"}</a> | 
					<a href="index.php?action=selectedFeed&amp;feed={$_['feed']}&amp;page={$page}&amp;order=older">{function="I18n::t('OLDER')"}</a> {function="I18n::t('IN_FIRST')"}
				{/if}
				
				{if="$action=='selectedFolder'"}
				<!-- AFFICHAGE DES EVENEMENTS D'UN DOSSIER EN PARTICULIER -->		
					<h1 class="articleSection">{function="I18n::t('FOLDER')"} : {$currentFolder->getName()}</h1>
					<p>{function="I18n::t('SEE_EVENTS_FOR_FOLDER',array($currentFolder->getName()))"}</p>
				{/if}
				
				{if="$action=='favorites'"}
				<!-- AFFICHAGE DES EVENEMENTS FAVORIS -->		
					<h1 class="articleSection">{function="I18n::t('FAVORITES_EVENTS',array('<span id="nbarticle">'.$numberOfItem.'</span>'))"}</h1>
				{/if}

				
				{if="($action=='unreadEvents') || ($action=='')"}
				<!-- AFFICHAGE DES EVENEMENTS NON LU (COMPORTEMENT PAR DEFAUT) -->		
					<h1 class="articleSection">{function="I18n::t('UNREAD')"} (<span id="nbarticle">{$numberOfItem}</span>)</h1>
				{/if}
			
			 	<div class="clear"></div>
				</header>
				{include="article"}
			</article>


		</div> <!-- #main -->

{else}
	<div id="main" class="wrapper clearfix">
		<article>
				<h3>{function="I18n::t('YOU_MUST_BE_LOGGED')"}</h3>
				<p>{function="I18n::t('IF_ADMIN_THEN_CONFIG')"}</p>
		</article>
	</div>
{/if}

{include="footer"}
